// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © gsk_shivu5

//@version=5
strategy("EMA Backtest", overlay=true, margin_long=100, margin_short=100)

// Define parameters
startPeriod = input(5, title="Start EMA Period")
endPeriod = input(50, title="End EMA Period")
stepSize = input(5, title="Step Size")

// Define function to calculate EMA
calcEMA(close, emaPeriod) =>
    // Calculate EMAs
    emaSeries = ta.ema(close, emaPeriod)
    emaSeries

// Initialize variables to store results
var float bestPerformance = na
var int bestEMA = na

// Loop through different EMA periods
for emaPeriod = startPeriod to endPeriod by stepSize
    // Reset the strategy
    strategy("EMA Backtest", overlay=true)
    
    // Calculate EMA for the current EMA period
    emaSeries = calcEMA(close, emaPeriod)
    
    // Calculate profit factor
    profitFactor = strategy.grossprofit / strategy.grossloss
    
    // Update best performance and EMA period if necessary
    if na(bestPerformance) or profitFactor > bestPerformance
        bestPerformance := profitFactor
        bestEMA := emaPeriod
// Output results
plot(series=bestPerformance, color=color.blue, linewidth=2, title="Best Performance")
plot(series=bestEMA, color=color.red, linewidth=2, title="Best EMA Period")

// Print best results
plotshape(series=bestPerformance, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small, title="Best Performance")
plotshape(series=bestEMA, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small, title="Best EMA Period")

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))
if (longCondition)
    strategy.entry("My Long Entry Id", strategy.long)

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))
if (shortCondition)
    strategy.entry("My Short Entry Id", strategy.short)